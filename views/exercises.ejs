<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exercices d'Anglais - E-Learning English</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<style>
    body { background: linear-gradient(135deg, #fff8f0, #ffe8cc); font-family: 'Poppins', sans-serif; color: #333; }
    .navbar { background: linear-gradient(90deg, #ff7b00, #ffae42); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .btn-admin { background: rgba(255,255,255,0.9); color: #ff7b00; font-weight: 600; border-radius: 50px; }
    .btn-admin:hover { background: white; transform: scale(1.05); color: #ff7b00; }
    .btn-info { background-color: #ff7b00; border: none; color: white; font-weight: 600; }
    .btn-info:hover { background-color: #ff9a33; transform: scale(1.05); }
    footer { margin-top: 60px; text-align: center; color: #777; font-size: 0.9rem; padding: 20px 0; }
  </style>
<body class="bg-light">
    <nav class="navbar navbar-expand-lg navbar-dark mb-5">
        <div class="container">
          <a class="navbar-brand" href="/"><i class="bi bi-book-half me-2"></i> E-Learning English</a>
          <div class="ms-auto d-flex gap-2">
            
            <a href="/" class="btn btn-admin btn-sm">
              <i class="bi bi-gear me-1"></i> Espace Utilisateur
            </a>
          </div>
        </div>
      </nav>

  <div class="container mt-5">
    <h3 class="text-center text-primary mb-4">
      <i class="bi bi-pencil-square"></i> Exercices d'Anglais
    </h3>

    <% if (exercises.length === 0) { %>
      <p class="text-center text-muted">Aucun exercice disponible pour le moment.</p>
    <% } %>

    <div class="row">
      <% exercises.forEach(ex => { %>
        <div class="col-md-6 mb-4">
          <div class="card p-3 shadow-sm">
            <h6><span class="badge bg-warning text-dark"><%= ex.level %></span></h6>
            <p><strong><%= ex.question %></strong></p>
            <form class="exercise-form" data-id="<%= ex.id %>">
              <% ex.options.forEach(option => { %>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="answer" value="<%= option %>">
                  <label class="form-check-label"><%= option %></label>
                </div>
              <% }) %>
              <button type="submit" class="btn btn-sm btn-primary mt-2">Vérifier</button>
              <div class="result mt-2"></div>
            </form>
          </div>
        </div>
      <% }) %>
    </div>
  </div>

  <script>
    document.querySelectorAll(".exercise-form").forEach(form => {
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const id = form.dataset.id;
        const answer = form.querySelector("input[name='answer']:checked");
        if (!answer) return alert("Choisissez une réponse !");
        const userAnswer = answer.value;
        const res = await fetch("/check-answer", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ id, userAnswer })
        });
        const data = await res.json();
        const resultDiv = form.querySelector(".result");
        if (data.correct) {
          resultDiv.innerHTML = `<span class='text-success fw-bold'>✅ Bonne réponse !</span>`;
        } else {
          resultDiv.innerHTML = `<span class='text-danger fw-bold'>❌ Mauvaise réponse. La bonne réponse est : ${data.correctAnswer}</span>`;
        }
      });
    });
  </script>

</body>
</html>
